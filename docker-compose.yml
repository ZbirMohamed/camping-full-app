services:
   campdb:
     image: mariadb:11
     container_name: dbC
     environment:
       MARIADB_ROOT_PASSWORD: test
       MARIADB_DATABASE: campBdd
     volumes:
       - camp-volume:/var/lib/mysql
     ports:
       - "3037:3036"
     healthcheck:
       test: [ "CMD", "healthcheck.sh", "--connect", "--innodb_initialized" ]
       start_period: 10s
       interval: 10s
       timeout: 5s
       retries: 3

   bookingDB:
     image: mariadb:11
     container_name: dbB
     environment:
       MARIADB_ROOT_PASSWORD: test
       MARIADB_DATABASE: bookingBdd
     volumes:
       - booking-volume:/var/lib/mysql
     ports:
       - "3038:3036"
     healthcheck:
       test: [ "CMD", "healthcheck.sh", "--connect", "--innodb_initialized" ]
       start_period: 10s
       interval: 10s
       timeout: 5s
       retries: 3

   camp-service:
     build: ./camp
     container_name: camp-service
     ports:
       - "8080:8080"
     expose:
       - "8080"
     environment:
       - MARIADB_URL=jdbc:mariadb://campdb:3306/campBdd?createDatabaseIfNotExist=true
     depends_on:
       campdb:
         condition: service_healthy

   booking-service:
     build: ./booking-service
     container_name: booking-service
     ports:
       - "8081:8081"
     expose:
       - "8081"
     environment:
       - MARIADB_URL=jdbc:mariadb://bookingDB:3306/bookingBdd?createDatabaseIfNotExist=true
     depends_on:
       bookingDB:
         condition: service_healthy


volumes:
  camp-volume:
  booking-volume: